#!/usr/bin/env ruby
require File.join(File.dirname(__FILE__), '..', 'lib', 'pik')

include Pik

args = ARGV
cmd  = args.shift || 'help'
cmd  = cmd.downcase.to_sym

Command.clean_gem_batch

begin
  config  = ConfigFile.new
  command = Commands.find(cmd) 
  command ||= if args = [Command.choose_from(ARGV.unshift(cmd), config)]
    Switch
  else
    Help
  end
  cmd = command.new(args, config)
  cmd.execute
rescue QuitError
  puts "\nQuitting..."
rescue => e
  puts "\nThere was an error"
  puts " Error: #{e.message}\n\n"
  puts e.backtrace
ensure
  cmd.close if cmd
end 
