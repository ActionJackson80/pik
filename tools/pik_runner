#!/usr/bin/env ruby

lib = File.join(File.dirname(__FILE__), '..', 'lib')
require File.join(lib, 'pik')

include Pik

args = ARGV

begin
  config  = ConfigFile.new
  
  command = if cmd = Commands.find(args[0])
    args.shift
    cmd
  elsif args[0] =~ /,/ && cmd = Commands.find(args[1])
    config.options[:versions] = args.shift
    args.shift
    cmd
  elsif version = config.match(args[0])
    args.shift
    config.options[:use] = version
    Use
  else
    Help
  end
  
  
  cmd = command.new(args, config)
  cmd.execute

rescue QuitError
  puts "\nQuitting..."
rescue => e
  Pik.print_error(e)
ensure
  cmd.close if cmd
end 
