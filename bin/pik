#!/usr/bin/env ruby
require File.join(File.dirname(__FILE__), '..', 'lib', 'pik')

include Pik

args = ARGV

Command.clean_gem_batch

begin
  config  = ConfigFile.new
  
  args << 'help' if args.empty?
  
  command = if Command.choose_from(args, config)
    Switch
  elsif (cmd = Commands.find(args.shift))
    cmd
  else
    Help
  end
  
  cmd = command.new(args, config)
  cmd.execute
rescue QuitError
  puts "\nQuitting..."
rescue => e
  puts "\nThere was an error"
  puts " Error: #{e.message}\n\n"
  puts e.backtrace
ensure
  cmd.close if cmd
end 
